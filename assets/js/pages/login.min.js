$(function() {
    altair_login_page.init();
});
// variables
var $login_card = $('#login_card'),
    $login_form = $('#login_form'),
    $login_password_reset = $('#login_password_reset');
altair_login_page = {
    init: function () {
        // show login form (hide other forms)
        var login_form_show = function() {
            $login_form.show().siblings().hide();
        };
        // show password reset form (hide other forms)
        var password_reset_show = function() {
            $login_password_reset.show().siblings().hide();
        };
        $('.back_to_login').on('click',function(e) {
            e.preventDefault();
            $('#form_forgot').trigger('reset');
            // card animation & complete callback: login_form_show
            altair_md.card_show_hide($login_card,undefined,login_form_show,undefined);
        });
        $('#password_reset_show').on('click',function(e) {
            e.preventDefault();
            $('#form_login').trigger('reset');
            // card animation & complete callback: password_reset_show
            altair_md.card_show_hide($login_card,undefined,password_reset_show,undefined);
        });
        $('#form_login').validate({
            errorPlacement: function(error, element) {
                error.insertAfter(element.parent());
            },
            submitHandler: function(form){
                var l = Ladda.create($(form).find('button').get(0));
                l.start();
                $.ajax({
                    url:$(form).attr("action"),
                    type:'POST',
                    data:$(form).serialize(),
                    datatype : "application/json",
                    success:function(data){
                        //console.log(data);
                        l.stop();
                        if(data.sucess == "true"){
                            notifyWithtEle(data.message,'success');
                            window.location = location.href;
                        }else{
                            notifyWithtEle(data.message,'danger');
                        }
                    }
                });
                return false;
            }
        });
        $('#form_forgot').validate({
            errorPlacement: function(error, element) {
                error.insertAfter(element.parent());
            },
            submitHandler: function(form){
                var l = Ladda.create($(form).find('button').get(0));
                l.start();
                $.ajax({
                    url:$(form).attr("action"),
                    type:'POST',
                    data:$(form).serialize(),
                    datatype : "application/json",
                    success:function(data){
                        l.stop();
                        if(data.sucess == "true"){
                            notifyWithtEle(data.message,'success');
                            altair_md.card_show_hide($login_card,undefined,login_form_show,undefined);
                            $(form).trigger("reset");
                        }else{
                            notifyWithtEle(data.message,'danger');
                            $(form).trigger("reset");
                        }
                    }
                });
                return false;
            }
        });
        $('#form_reset').validate({
            rules:{
                confirmpassword: {
                    equalTo: "#rpassword"
                }
            },
            errorPlacement: function(error, element) {
                error.insertAfter(element.parent());
            },
            submitHandler: function(form){
                var l = Ladda.create($(form).find('button').get(0));
                l.start();
                $.ajax({
                    url:$(form).attr("action"),
                    type:'POST',
                    data:$(form).serialize(),
                    datatype : "application/json",
                    success:function(data){
                        l.stop();
                        if(data.sucess == "true"){
                            notifyWithtEle(data.message,'success');
                            altair_md.card_show_hide($login_card,undefined,login_form_show,undefined);
                            $(form).trigger("reset");
                        }else{
                            notifyWithtEle(data.message,'danger');
                            $(form).trigger("reset");
                        }
                    }
                });
                return false;
            }
        });
    }
};